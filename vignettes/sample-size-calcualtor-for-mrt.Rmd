---
title: "Sample Size Calculator for Micro Randomized Trials"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{sample-size-calcualtor-for-mrt}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(mrtbincalc)
```

# Introduction 
This package provides a sample size calculator for Micro-randomized Trials (MRT) with binary outcomes. The sample size formula is developed in Sample Size Considerations for Micro-Randomized Trials with Binary Outcome.

In an MRT, each participant is repeatedly randomized among multiple options of an intervention (no intervention is usually one of the options), usually hundreds or thousands of times throughout the trial. The prefix “micro-” reflects the frequent randomization on each participant. After each of such times (called a decision point), a near-term, proximal outcome is measured, which is typically an outcome that the intervention is directly targeting. For example, in a study where the intervention is a push notification suggesting a near-term physical exercise, the proximal outcome is the step count in the subsequent 30
minutes (Klasnja et al., 2015).


# Installation 

Note sure what to put for this section 


The outputs in this package are power and sample size in the context of MRT.
In both cases, you will need to input the desired significance level.


This document provides examples of the use of this package. It relies on the some specific information from the MRT set up, such as the duration of the study in days, the number of decision time points within each day , and the randomization probability.That is, the probability of assigning the treatment at a decision time point. 

# Quick Start

To illustrate, we provide an example of such input:

```{r}

set.seed(1)
total_decision_points <- 10
expected_availability <- rep(0.8, 10)  
rand_prob_at_time_point <- rep(0.4, total_dp) 
type_I_error <- 0.05 
type_II_error <- 0.2 

calculate_mrt_bin_samplesize_f(tau_t_1, f_t_1, g_t_1, beta_1, alpha_1, p_t_1, 0.05, .2, FALSE)
calculate_mrt_bin_power_f(tau_t_1, f_t_1, g_t_1, beta_1, alpha_1, p_t_1, 0.05, 100)
compute_m_sigma(tau_t_1, f_t_1, g_t_1, beta_1, alpha_1, p_t_1)
compute_ncp(300, beta_1, m_matrix_1, sigma_matrix_1)
power_vs_n_plot(tau_t_1, f_t_1, g_t_1, beta_1, alpha_1, p_t_1, 0.05)
#power_summary(tau_t_1, f_t_1, g_t_1, beta_1, alpha_1, p_t_1, 0.05)
```


* Minimum ample size for the desired power level* 

```{r}
### specify g_t and alpha ###
g_t_1 <- cbind(rep(1, total_dp), 1:total_dp)  
alpha_1 <- as.matrix(c(-0.2, -0.1), ncol = 1)

# checking that probability E(Y_{t+1} = 1 | I_t = 1, A_t = 0) should always be between 0 and 1.
mu0_t<- exp(g_t_1 %*% alpha_1) # E(Y_{t+1} = 1 | I_t = 1, A_t = 0) for t = 1,...,total_dp
#mu0_t_1 # look at the mu0_t values
stopifnot(all(mu0_t < 1) & all(mu0_t > 0))

### specify f_t and beta ###
f_t_1 <- cbind(rep(1, total_dp), 1:total_dp)  # f_t = (1, t)
beta_1 <- as.matrix(c(0.15, - 0.01), ncol = 1)

# checking that probability E(Y_{t+1} = 1 | I_t = 1, A_t = 1) should always be between 0 and 1.
mee_t <- f_t_1 %*% beta_1 # MEE(t) for t = 1,...,total_dp
mu1_t <- mu0_t * exp(mee_t) # E(Y_{t+1} = 1 | I_t = 1, A_t = 1) for t = 1,...,total_dp
#mu1_t # look at the mu1_t values
stopifnot(all(mu1_t < 1) & all(mu1_t > 0))

```



# Availability
Treatment can only be provided when an individual is available; The expected availability is the probability a person is available to receive the intervention at the decision times.
To use this package, you need to select a time-varying pattern for the expected availability. There are tow patterns you can choose from: constant, or linear over decision points.

3. Success Probability Null Curve
The Success Probability Null Curve at each decision time point is defined as the probability of the proximal outcome equal to 1 for available individuals who are not assigned treatment.
You need to provide the trend of success probability null curve. This could be either constant or linear over decision points.

4. Proximal Treatment Effect
The Proximal Treatment Effect at each decision time point is defined as the mean difference in the proximal outcome between available people who are assigned a treatment versus available people who are not assigned treatment. In this work, we only consider the binary treatment. You need to provide the trend of proximal treatment effects. This could be either constant or time-varying, e.g. linear or quadratic over decision points.




