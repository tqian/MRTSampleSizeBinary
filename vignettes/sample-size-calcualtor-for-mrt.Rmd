---
title: "Sample Size Calculator for Micro Randomized Trials"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{sample-size-calcualtor-for-mrt}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  
bibliography: vig_bib.bib
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(mrtbincalc)
```

# Introduction 
The *mrtbincalc* provides a sample size calculator for Micro-Randomized Trials (MRT) with binary outcomes. The sample size formula is developed in sample size considerations for MRT with Binary Outcome. This package provides the optimum sample size needed for a specified power, and the desired significance level in the context of MRT.

In an MRT, each participant is repeatedly randomized among multiple options of an intervention (no intervention is usually one of the options), usually hundreds or thousands of times throughout the trial. The prefix “micro” reflects the frequent randomization on each participant. After each of such times (called a decision point), a near-term, proximal outcome is measured, which is typically an outcome that the intervention is directly targeting. For example, in a study where the intervention is a push notification suggesting a near-term physical exercise, the proximal outcome is the step count in the subsequent 30 minutes @klasnja2020quality.


# Quick Start

This section provides examples of the use of this package, it allowed the user to see the basic operations and what the outputs would look like. The functions in this package rely on the some specific information from the MRT set up, such as the duration of the study in days, the number of decision time points within each day, and the randomization probability.That is, the probability of assigning the treatment at a decision time point. 

Since in an MRT treatment can only be provided when an individual is available; The expected availability is the probability a person is available to receive the intervention at the decision times. To use this package, you need to select a time-varying pattern for the expected availability. There are tow patterns you can choose from: constant, or linear over decision points.


Another pre specified information that the user needs to provide is the success probability null curve at each decision time point. It is defined as the probability of the proximal outcome equal to 1 for available individuals who are not assigned treatment. The user needs to provide the trend of success probability of the null curve. This could be either constant or linear over decision points.


Finally, the proximal treatment effect at each decision time point is defined as the mean difference in the proximal outcome between available people who are assigned a treatment versus available people who are not assigned treatment. In this work, we only consider the binary treatment. One needs to provide the trend of proximal treatment effects. 

We load a set of data created beforehand for illustration:
 
```{r}
# 
# data(tau_t_1)
# data(alpha_1) 
# data(beta_1)
# data(f_t_1)
# data(g_t_1)
# data(m_matrix_1)
# data(p_t_1)
# data(sigma_matrix_1)

```


*tau_t_1*: Vector of length T that holds the average availability at each time point.

*f_t_1*: A 2 by 10 matrix defining the alternative hypothesis. In this example it is a log-linear trend.

*g_t_1*: A 2 by 10 matrix defining the null hypothesis.In this example it is a log-linear trend.

*p_t_1*: A length T vector of randomization probabilities for each time point.  

*beta_1*: Vector that defines the alternative hypothesis.The matrix multiplication of this vector with f_t_1 defines the MEE under the alternative hypothesis.

*alpha_1* : A length of 2 vector that defines the null hypothesis.The matrix multiplication of this vector with g_t_1 defines the MEE under the null hypothesis.

*sigma_matrix_1*: An example matrix for "meat" of sandwich estimator of variance.

*m_matrix_1*: An example matrix for "bread" of sandwich estimator of variance.


If the uses is interested in calculating the estimated variance matrix, we can use   

```{r}

compute_m_sigma(tau_t_1, f_t_1, g_t_1, beta_1, alpha_1, p_t_1)
```


 Since the package relies on a test statistic that is distributed as a non-central chi-squared with p degrees of freedom under the alternative hypothesis. The test is to find significance of the marginal excursion effect between the available intervention and the control groups were considered for randomization @pan2002small.
 
 Then the following function can calculate the non central parameter of the test statistic. This function needs the estimated co-varince matrix that we have seen above and a sample size. 
 
```{r}
compute_ncp(300, beta_1, m_matrix_1, sigma_matrix_1)

```


The main operation of this package is to find the optimum sample size in the context of MRT, specifically for the loaded data we have in the workplace, and with a significance level and power level:  

```{r}
calculate_mrt_bin_samplesize_f(tau_t_1, f_t_1, g_t_1, beta_1, alpha_1, p_t_1, 0.05, .2, FALSE)
```


If the investigator would like to calculate power based on some suggested sample size that is feasible in the study, with a specified significance level, then this function can calculate the power: 

```{r}
calculate_mrt_bin_power_f(tau_t_1, f_t_1, g_t_1, beta_1, alpha_1, p_t_1, 0.05, 300)

```
Based on the fraction of power calculated above, the user can employ this information to trade off/ make the decision on power vs. sample size. This decision can be costly, and so having a visualization of this relationship between power and sample size can be beneficial. 

Thus, the package provides a visualization of this relationship and so we recommend the user to use to following function :


```{r powe-plot, fig.align='center'}
power_vs_n_plot(tau_t_1, f_t_1, g_t_1, beta_1, alpha_1, p_t_1, 0.05)

```


Another way to look at this information that quantifies power in relation to sample size, is by looking at a list of specific powers and the sample size needed to achieve it. This package offeres a power-summary function that considers sample sizes for power ranging from 0.6 to 0.95.
```{r}
power_summary(tau_t_1, f_t_1, g_t_1,beta_1, alpha_1, p_t_1, 0.05)
```




# References







